# Устранение проблем с камерой на Windows 11

## Проблема: "NotReadableError: Could not start video source"

Эта ошибка возникает, когда браузер не может получить доступ к камере на Windows 11.

## Причины и решения

### 1. Камера используется другим приложением

**Симптомы:** Ошибка "NotReadableError" или "Camera already in use"

**Решение:**
1. Закройте все программы, которые могут использовать камеру:
   - Microsoft Teams
   - Skype
   - Zoom
   - Discord
   - OBS Studio
   - Любые другие приложения для видеосвязи

2. Откройте Диспетчер задач (Ctrl+Shift+Esc) и завершите процессы:
   - Найдите программы видеосвязи в списке процессов
   - Щелкните правой кнопкой → "Завершить задачу"

3. Перезагрузите браузер после закрытия программ

### 2. Настройки конфиденциальности Windows 11

**Решение:**

1. **Разрешите доступ к камере в Windows:**
   - Нажмите Win + I (Параметры)
   - Перейдите в "Конфиденциальность и безопасность" → "Камера"
   - Включите "Доступ к камере"
   - Включите "Разрешить приложениям доступ к камере"
   - Включите "Разрешить классическим приложениям доступ к камере"

2. **Проверьте разрешения для браузера:**
   - В том же разделе прокрутите вниз
   - Найдите ваш браузер (Chrome, Edge, Firefox) в списке
   - Убедитесь, что переключатель включен

### 3. Разрешения браузера

#### Google Chrome / Microsoft Edge:
1. Откройте сайт OlimpQR
2. Нажмите на значок замка слева от адресной строки
3. Выберите "Настройки сайта" или "Разрешения"
4. Найдите "Камера"
5. Выберите "Разрешить"
6. Перезагрузите страницу

**Альтернативный способ:**
1. Откройте `chrome://settings/content/camera`
2. Убедитесь, что "Сайты могут запрашивать доступ к камере" включено
3. Проверьте, что ваш сайт не в списке заблокированных

#### Mozilla Firefox:
1. Откройте сайт OlimpQR
2. Нажмите на значок камеры в адресной строке
3. Выберите "Разрешить"
4. Перезагрузите страницу

### 4. Проверка работы камеры

**Проверьте камеру в Windows:**
1. Откройте приложение "Камера" (встроенное в Windows)
2. Если камера работает здесь, проблема в браузере
3. Если не работает, проблема в драйверах или оборудовании

**Обновите драйверы камеры:**
1. Win + X → "Диспетчер устройств"
2. Разверните "Камеры" или "Устройства обработки изображений"
3. Щелкните правой кнопкой на вашей камере
4. Выберите "Обновить драйвер"

### 5. HTTPS требования

**Проблема:** Браузеры требуют HTTPS для доступа к камере

**Решение для разработки:**
- Убедитесь, что сайт запущен на `localhost` или `127.0.0.1`
- Эти адреса считаются безопасными даже по HTTP

**Решение для продакшена:**
- Используйте HTTPS (SSL сертификат)
- Настройте обратный прокси (nginx, apache) с SSL

### 6. Проблемы с несколькими камерами

Если у вас несколько камер (встроенная + внешняя USB):

1. Отключите внешнюю USB камеру
2. Перезагрузите браузер
3. Попробуйте снова
4. Если работает, браузер выбирает неправильную камеру по умолчанию

### 7. Антивирус блокирует доступ

Некоторые антивирусы блокируют доступ к камере:

1. Временно отключите антивирус
2. Попробуйте использовать камеру
3. Если работает, добавьте браузер в исключения антивируса

## Быстрая диагностика

Выполните эти шаги по порядку:

```bash
# 1. Проверьте, работает ли камера в Windows
# Откройте приложение "Камера"

# 2. Проверьте доступ к камере в браузере
# Откройте в браузере: chrome://settings/content/camera

# 3. Проверьте, какие процессы используют камеру
# В PowerShell:
Get-Process | Where-Object {$_.ProcessName -like "*camera*"}
```

## Альтернативное решение: Загрузка файла

Если камера не работает, используйте функцию загрузки файла:

1. Сфотографируйте QR-код на телефоне
2. Перенесите фото на компьютер
3. Используйте кнопку "Загрузить файл" в сканере QR
4. Выберите файл с фотографией

## Технические детали исправления

В компоненте `QRScanner.tsx` реализованы:

1. **Проверка разрешений перед запуском камеры**
   ```typescript
   await navigator.mediaDevices.getUserMedia({
     video: {
       facingMode: 'environment',
       width: { ideal: 1280 },
       height: { ideal: 720 }
     }
   });
   ```

2. **Детальная обработка ошибок:**
   - `NotAllowedError` - доступ запрещен пользователем
   - `NotFoundError` - камера не найдена
   - `NotReadableError` - камера занята другим приложением

3. **Понятные сообщения об ошибках** с инструкциями по исправлению

4. **Поддержка загрузки файлов** как альтернатива камере

## Проверка после исправления

1. Закройте все программы, использующие камеру
2. Перезагрузите браузер
3. Откройте страницу со сканером QR
4. Разрешите доступ к камере при запросе
5. Камера должна заработать

## Частые вопросы

**Q: Почему в других браузерах камера работает, а здесь нет?**
A: Разные браузеры имеют разные политики безопасности. Chrome и Edge более строгие к HTTPS требованиям.

**Q: Можно ли использовать сканер без камеры?**
A: Да, используйте функцию загрузки файла - сфотографируйте QR-код и загрузите изображение.

**Q: Камера работала раньше, но перестала работать после обновления Windows.**
A: Проверьте настройки конфиденциальности Windows - они могли сброситься после обновления.

## Контакты поддержки

Если проблема не решается:
1. Откройте issue на GitHub: https://github.com/anthropics/claude-code/issues
2. Укажите:
   - Версию Windows (Win + R → winver)
   - Версию браузера (Настройки → О браузере)
   - Текст ошибки из консоли (F12 → Console)
